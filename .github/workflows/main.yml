name: Run My Bot Forever1

on:
  workflow_dispatch: # ╪к╪┤╪║┘К┘Д ┘К╪п┘И┘К
  schedule:
    - cron: '0 */6 * * *' # ╪к╪┤╪║┘К┘Д ╪к┘Д┘В╪з╪ж┘К ┘Г┘Д 6 ╪│╪з╪╣╪з╪к

permissions:
  actions: write # ╪╢╪▒┘И╪▒┘К ┘Д╪е╪╣╪з╪п╪й ╪з┘Д╪к╪┤╪║┘К┘Д ╪з┘Д╪░╪з╪к┘К

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable tor xvfb
          pip install selenium requests

      - name: Configure and Start Tor
        run: |
          # ╪е┘К┘В╪з┘Б ╪г┘К ╪╣┘Е┘Д┘К╪й ╪│╪з╪и┘В╪й ┘Д╪╢┘Е╪з┘Ж ╪и╪п╪з┘К╪й ┘Ж╪╕┘К┘Б╪й
          sudo service tor stop || true
          
          # ╪е╪╣╪п╪з╪п ┘Е┘Д┘Б ╪з┘Д┘Г┘И┘Ж┘Б┘К╪м ╪и╪┤┘Г┘Д ┘К╪╢┘Е┘Ж ┘Б╪к╪н ╪з┘Д┘Е┘Ж┘Б╪░ 9051
          sudo bash -c 'echo -e "ControlPort 9051\nCookieAuthentication 0\nDataDirectory /var/lib/tor" > /etc/tor/torrc'
          
          # ╪к╪┤╪║┘К┘Д ╪з┘Д╪о╪п┘Е╪й
          sudo service tor start
          
          # тЪая╕П ╪з┘Д╪к╪║┘К┘К╪▒ ╪з┘Д┘Е┘З┘Е: ┘Ж┘Ж╪к╪╕╪▒ 20 ╪л╪з┘Ж┘К╪й ╪и╪п┘Д╪з┘Л ┘Е┘Ж 5 ┘Д╪╢┘Е╪з┘Ж ╪м╪з┘З╪▓┘К╪й Tor
          echo "тП│ Waiting for Tor to establish circuit..."
          sleep 20

      - name: Start Bot
        # ╪з╪│╪к╪о╪п╪з┘Е -u ┘К╪╕┘З╪▒ ╪з┘Д╪│╪м┘Д ┘Б┘И╪▒╪з┘Л╪М ┘И timeout ┘К╪╢┘Е┘Ж ╪е╪╣╪з╪п╪й ╪з┘Д╪к╪┤╪║┘К┘Д ┘В╪и┘Д ╪з┘Д┘А 6 ╪│╪з╪╣╪з╪к
        run: |
          timeout 350m xvfb-run python -u bot_master1.py || echo "тЪая╕П ╪з┘Ж╪к┘З╪к ╪з┘Д╪м┘Д╪│╪й╪М ╪м╪з╪▒┘К ╪з┘Д╪к╪м┘З┘К╪▓ ┘Д┘Д╪м┘И┘Д╪й ╪з┘Д╪к╪з┘Д┘К╪й..."

      - name: Self-Restart Workflow
        if: always() 
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "ЁЯЪА ╪г┘Е╪▒ ╪з┘Д╪к╪┤╪║┘К┘Д ╪з┘Д╪░╪з╪к┘К: ┘Д┘Ж ┘К╪к┘И┘В┘Б ╪з┘Д╪и┘И╪к ╪г╪и╪п╪з┘Л!"
          gh workflow run "Run My Bot Forever"
